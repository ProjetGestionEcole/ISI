<div class="document-upload-container">
    <div class="upload-header mb-3" *ngIf="documentTypes.length > 0">
        <h6 class="text-900 mb-2">Types de documents acceptés:</h6>
        <div class="flex flex-wrap gap-2">
            <p-tag 
                *ngFor="let type of documentTypes" 
                [value]="type.label"
                severity="info"
                styleClass="text-xs"
                [pTooltip]="type.description">
            </p-tag>
        </div>
    </div>

    <p-fileUpload 
        [name]="'documents[]'"
        [url]="uploadUrl()"
        [accept]="acceptedFormats()"
        [maxFileSize]="maxFileSize()"
        [multiple]="(config?.maxFiles || 10) > 1"
        [auto]="config?.autoUpload || false"
        [customUpload]="true"
        (onSelect)="onSelect($event)"
        (onRemove)="onRemove($event)"
        (onClear)="onClear()"
        (uploadHandler)="startUpload()"
        [disabled]="uploading()">
        
        <ng-template pTemplate="toolbar">
            <div class="flex flex-wrap align-items-center gap-2">
                <p-button 
                    label="Choisir"
                    icon="pi pi-plus"
                    severity="success"
                    size="small"
                    [disabled]="!canUploadMore() || uploading()">
                </p-button>
                
                <p-button 
                    *ngIf="!config?.autoUpload && selectedFiles().length > 0"
                    label="Uploader"
                    icon="pi pi-upload"
                    (onClick)="startUpload()"
                    [loading]="uploading()"
                    size="small">
                </p-button>
                
                <p-button 
                    *ngIf="selectedFiles().length > 0 && !uploading()"
                    label="Effacer"
                    icon="pi pi-times"
                    severity="secondary"
                    (onClick)="onClear()"
                    size="small">
                </p-button>
            </div>
        </ng-template>

        <ng-template pTemplate="content">
            <div class="upload-content">
                <!-- Drop Zone -->
                <div class="drop-zone text-center py-6" *ngIf="selectedFiles().length === 0">
                    <i class="pi pi-cloud-upload text-6xl text-400 mb-3"></i>
                    <h5 class="text-600 mb-2">Glissez-déposez vos fichiers ici</h5>
                    <p class="text-500 mb-3">ou cliquez sur "Choisir" pour parcourir</p>
                    <div class="upload-constraints text-xs text-500">
                        <div>Taille max: {{ formatFileSize(maxFileSize()) }}</div>
                        <div>Formats: {{ acceptedFormats() }}</div>
                        <div *ngIf="config?.maxFiles">Max fichiers: {{ config.maxFiles }}</div>
                    </div>
                </div>

                <!-- Selected Files -->
                <div class="selected-files" *ngIf="selectedFiles().length > 0">
                    <h6 class="text-900 mb-3">Fichiers sélectionnés ({{ selectedFiles().length }})</h6>
                    <div class="files-list">
                        <div 
                            class="file-item flex align-items-center justify-content-between p-3 border-1 surface-border border-round mb-2"
                            *ngFor="let file of selectedFiles()">
                            <div class="flex align-items-center">
                                <i class="pi text-2xl mr-3" [ngClass]="getFileIcon(file.name)"></i>
                                <div class="file-info">
                                    <div class="file-name font-medium text-900">{{ file.name }}</div>
                                    <div class="file-size text-sm text-500">{{ formatFileSize(file.size) }}</div>
                                </div>
                            </div>
                            <p-button 
                                icon="pi pi-times"
                                severity="danger"
                                size="small"
                                styleClass="p-button-rounded p-button-text"
                                (onClick)="onRemove({file: file})"
                                [disabled]="uploading()">
                            </p-button>
                        </div>
                    </div>
                </div>

                <!-- Upload Progress -->
                <div class="upload-progress" *ngIf="uploadProgress().length > 0">
                    <h6 class="text-900 mb-3">Progression de l'upload</h6>
                    <div class="progress-list">
                        <div 
                            class="progress-item mb-3"
                            *ngFor="let progress of uploadProgress()">
                            <div class="flex align-items-center justify-content-between mb-2">
                                <span class="text-sm font-medium">{{ progress.fileName }}</span>
                                <p-tag 
                                    [value]="progress.status"
                                    [severity]="getProgressSeverity(progress.status)"
                                    styleClass="text-xs">
                                </p-tag>
                            </div>
                            <p-progressBar 
                                [value]="progress.progress"
                                [showValue]="false"
                                styleClass="h-1rem">
                            </p-progressBar>
                            <div class="text-xs text-500 mt-1">{{ progress.progress }}%</div>
                            <div 
                                *ngIf="progress.error" 
                                class="text-xs text-red-500 mt-1">
                                {{ progress.error }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-template>

        <ng-template pTemplate="file" let-file let-remove="removeHandler">
            <!-- Custom file template if needed -->
        </ng-template>
    </p-fileUpload>

    <!-- Upload Instructions -->
    <div class="upload-instructions mt-3 p-3 bg-blue-50 border-round" *ngIf="!uploading()">
        <div class="flex align-items-start">
            <i class="pi pi-info-circle text-blue-500 mr-2 mt-1"></i>
            <div>
                <div class="text-sm text-blue-700 font-medium mb-1">Instructions d'upload</div>
                <ul class="text-xs text-blue-600 m-0 pl-3">
                    <li>Sélectionnez des fichiers au format {{ acceptedFormats() }}</li>
                    <li>Taille maximale par fichier: {{ formatFileSize(maxFileSize()) }}</li>
                    <li *ngIf="config?.maxFiles">Maximum {{ config.maxFiles }} fichier(s) à la fois</li>
                    <li>Les documents seront automatiquement classés par type</li>
                </ul>
            </div>
        </div>
    </div>
</div>