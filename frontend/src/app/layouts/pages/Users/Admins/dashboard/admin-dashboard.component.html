<div class="grid">
    <!-- Header Section -->
    <div class="col-12">
        <div class="flex justify-content-between align-items-center mb-4">
            <h1 class="text-2xl font-medium text-900 m-0">Dashboard Administration</h1>
            <p-button 
                icon="pi pi-refresh" 
                label="Actualiser" 
                (onClick)="refreshDashboard()"
                [loading]="loading()"
                severity="secondary"
                size="small">
            </p-button>
        </div>
    </div>

    <!-- Error Message -->
    <div class="col-12" *ngIf="error()">
        <div class="bg-red-100 border-left-3 border-red-500 text-red-700 p-4 mb-4">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="pi pi-exclamation-triangle text-red-500"></i>
                </div>
                <div class="ml-3">
                    <p class="text-sm">{{ error() }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Metrics Cards -->
    <div class="col-12 lg:col-3 md:col-6">
        <div class="card mb-0">
            <div class="flex justify-content-between mb-3">
                <div>
                    <span class="block text-500 font-medium mb-3">
                        Total Classes
                    </span>
                    <div class="text-900 font-medium text-xl">
                        <p-skeleton *ngIf="loading()" height="2rem" width="4rem"></p-skeleton>
                        <span *ngIf="!loading()">{{ getMetricValue('totalClasses') | number }}</span>
                    </div>
                </div>
                <div class="flex align-items-center justify-content-center bg-orange-100 border-round"
                     style="width:2.5rem;height:2.5rem">
                    <i class="pi pi-home text-xl text-orange-500"></i>
                </div>
            </div>
            <span class="text-green-500 font-medium" *ngIf="!loading()">
                0% depuis le mois dernier
            </span>
            <span class="text-500">depuis le mois dernier</span>
        </div>
    </div>

    <div class="col-12 lg:col-3 md:col-6">
        <div class="card mb-0">
            <div class="flex justify-content-between mb-3">
                <div>
                    <span class="block text-500 font-medium mb-3">
                        Total Élèves
                    </span>
                    <div class="text-900 font-medium text-xl">
                        <p-skeleton *ngIf="loading()" height="2rem" width="4rem"></p-skeleton>
                        <span *ngIf="!loading()">{{ getMetricValue('totalEleves') | number }}</span>
                    </div>
                </div>
                <div class="flex align-items-center justify-content-center bg-blue-100 border-round"
                     style="width:2.5rem;height:2.5rem">
                    <i class="pi pi-users text-xl text-blue-500"></i>
                </div>
            </div>
            <span class="text-green-500 font-medium" *ngIf="!loading()">
                +12% depuis le mois dernier
            </span>
            <span class="text-500">depuis le mois dernier</span>
        </div>
    </div>

    <div class="col-12 lg:col-3 md:col-6">
        <div class="card mb-0">
            <div class="flex justify-content-between mb-3">
                <div>
                    <span class="block text-500 font-medium mb-3">
                        Total Enseignants
                    </span>
                    <div class="text-900 font-medium text-xl">
                        <p-skeleton *ngIf="loading()" height="2rem" width="4rem"></p-skeleton>
                        <span *ngIf="!loading()">{{ getMetricValue('totalEnseignants') | number }}</span>
                    </div>
                </div>
                <div class="flex align-items-center justify-content-center bg-green-100 border-round"
                     style="width:2.5rem;height:2.5rem">
                    <i class="pi pi-user-plus text-xl text-green-500"></i>
                </div>
            </div>
            <span class="text-green-500 font-medium" *ngIf="!loading()">
                +5% depuis le mois dernier
            </span>
            <span class="text-500">depuis le mois dernier</span>
        </div>
    </div>

    <div class="col-12 lg:col-3 md:col-6">
        <div class="card mb-0">
            <div class="flex justify-content-between mb-3">
                <div>
                    <span class="block text-500 font-medium mb-3">
                        Total Matières
                    </span>
                    <div class="text-900 font-medium text-xl">
                        <p-skeleton *ngIf="loading()" height="2rem" width="4rem"></p-skeleton>
                        <span *ngIf="!loading()">{{ getMetricValue('totalMatieres') | number }}</span>
                    </div>
                </div>
                <div class="flex align-items-center justify-content-center bg-purple-100 border-round"
                     style="width:2.5rem;height:2.5rem">
                    <i class="pi pi-book text-xl text-purple-500"></i>
                </div>
            </div>
            <span class="text-green-500 font-medium" *ngIf="!loading()">
                +3% depuis le mois dernier
            </span>
            <span class="text-500">depuis le mois dernier</span>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="col-12 xl:col-8">
        <div class="card">
            <h5>Répartition par Spécialités</h5>
            <p-skeleton *ngIf="chartsLoading()" height="20rem"></p-skeleton>
            <p-chart 
                *ngIf="!chartsLoading() && specialitesChart()"
                type="doughnut" 
                [data]="specialitesChart()" 
                [options]="chartOptions"
                height="400px">
            </p-chart>
        </div>
    </div>

    <div class="col-12 xl:col-4">
        <div class="card mb-4">
            <h5>Statut des Élèves</h5>
            <p-skeleton *ngIf="chartsLoading()" height="10rem"></p-skeleton>
            <p-chart 
                *ngIf="!chartsLoading() && eleveStatusChart()"
                type="pie" 
                [data]="eleveStatusChart()" 
                [options]="chartOptions"
                height="200px">
            </p-chart>
        </div>

        <div class="card">
            <h5>Types de Contrats</h5>
            <p-skeleton *ngIf="chartsLoading()" height="10rem"></p-skeleton>
            <p-chart 
                *ngIf="!chartsLoading() && enseignantContractChart()"
                type="bar" 
                [data]="enseignantContractChart()" 
                [options]="barChartOptions"
                height="200px">
            </p-chart>
        </div>
    </div>

    <!-- Statistics Summary -->
    <div class="col-12 lg:col-6">
        <div class="card">
            <h5>Résumé Statistique</h5>
            <div class="grid">
                <div class="col-6">
                    <div class="text-center p-3 border-right-1 surface-border">
                        <span class="text-xl text-900 font-medium">
                            <p-skeleton *ngIf="loading()" height="1.5rem" width="3rem"></p-skeleton>
                            <span *ngIf="!loading()">{{ totalUsers() }}</span>
                        </span>
                        <div class="text-500 mt-1">Total Utilisateurs</div>
                        <div class="text-green-500 mt-2">
                            <i class="pi pi-arrow-up mr-1"></i>
                            <span class="font-medium">+8.2%</span>
                        </div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="text-center p-3">
                        <span class="text-xl text-900 font-medium">
                            <p-skeleton *ngIf="loading()" height="1.5rem" width="3rem"></p-skeleton>
                            <span *ngIf="!loading()">{{ completionRate() }}%</span>
                        </span>
                        <div class="text-500 mt-1">Taux d'inscription</div>
                        <div class="text-green-500 mt-2">
                            <i class="pi pi-arrow-up mr-1"></i>
                            <span class="font-medium">+2.1%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mt-4">
                <div class="flex justify-content-between mb-2">
                    <span class="text-600">Progression inscriptions</span>
                    <span class="text-900 font-medium">{{ completionRate() }}%</span>
                </div>
                <p-progressBar [value]="completionRate()" [showValue]="false" styleClass="h-1rem"></p-progressBar>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="col-12 lg:col-6">
        <div class="card">
            <h5>Actions Rapides</h5>
            <div class="grid">
                <div class="col-6">
                    <p-button 
                        label="Gérer Élèves" 
                        icon="pi pi-users" 
                        (onClick)="navigateToEleves()"
                        styleClass="w-full p-button-outlined mb-2"
                        size="small">
                    </p-button>
                </div>
                <div class="col-6">
                    <p-button 
                        label="Gérer Enseignants" 
                        icon="pi pi-user-plus" 
                        (onClick)="navigateToEnseignants()"
                        styleClass="w-full p-button-outlined mb-2"
                        size="small">
                    </p-button>
                </div>
                <div class="col-6">
                    <p-button 
                        label="Gérer Classes" 
                        icon="pi pi-home" 
                        (onClick)="navigateToClasses()"
                        styleClass="w-full p-button-outlined mb-2"
                        size="small">
                    </p-button>
                </div>
                <div class="col-6">
                    <p-button 
                        label="Gérer Matières" 
                        icon="pi pi-book" 
                        (onClick)="navigateToMatieres()"
                        styleClass="w-full p-button-outlined mb-2"
                        size="small">
                    </p-button>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activities -->
    <div class="col-12">
        <div class="card">
            <div class="flex justify-content-between align-items-center mb-4">
                <h5 class="m-0">Activités Récentes</h5>
                <p-button 
                    label="Voir tout" 
                    icon="pi pi-external-link" 
                    severity="secondary" 
                    size="small"
                    styleClass="p-button-text">
                </p-button>
            </div>

            <p-skeleton *ngIf="activitiesLoading()" height="8rem"></p-skeleton>

            <div *ngIf="!activitiesLoading()" class="timeline">
                <div class="timeline-item" *ngFor="let activity of activities(); let i = index">
                    <div class="timeline-marker">
                        <i class="pi" [ngClass]="getActivityIcon(activity.type)"></i>
                    </div>
                    <div class="timeline-content">
                        <div class="flex justify-content-between align-items-start mb-2">
                            <div>
                                <h6 class="m-0 mb-1">{{ activity.title }}</h6>
                                <p class="text-600 m-0 text-sm">{{ activity.description }}</p>
                            </div>
                            <div class="flex flex-column align-items-end">
                                <p-tag 
                                    [value]="activity.type" 
                                    [severity]="getActivitySeverity(activity.severity)"
                                    styleClass="text-xs">
                                </p-tag>
                                <small class="text-500 mt-1">{{ formatDate(activity.timestamp) }}</small>
                            </div>
                        </div>
                        <div class="text-500 text-sm" *ngIf="activity.user">
                            <i class="pi pi-user mr-1"></i>
                            {{ activity.user }}
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="!activitiesLoading() && activities().length === 0" class="text-center py-4">
                <i class="pi pi-info-circle text-4xl text-400 mb-3"></i>
                <p class="text-600">Aucune activité récente</p>
            </div>
        </div>
    </div>
</div>